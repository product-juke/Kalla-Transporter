<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Tree View -->
    <record id="view_mart_customer_invoice_tree" model="ir.ui.view">
        <field name="name">mart.customer.invoice.tree</field>
        <field name="model">mart.customer.invoice</field>
        <field name="arch" type="xml">
            <tree string="Customer Invoice" default_order="invoice_status desc, days_overdue desc">
                <field name="status_indicator" string="Status"/>
                <field name="customer" string="Customer"/>
                <field name="invoice_date" string="Invoice Date"/>
                <field name="invoice_date_due" string="Due Date"/>
                <field name="revenue" string="Revenue" sum="Total Revenue"/>
                <field name="invoice_status" string="Status"/>
                <field name="overdue_category" string="Overdue Category"/>
                <field name="days_overdue" string="Days Overdue"/>
                <field name="invoice_state" string="Invoice State"/>
                <field name="payment_state" string="Payment State"/>
                <field name="is_invoicing_issue" string="Invoicing Issue"/>
                <field name="is_bad_debt_issue" string="Bad Debt Issue"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_mart_customer_invoice_form" model="ir.ui.view">
        <field name="name">mart.customer.invoice.form</field>
        <field name="model">mart.customer.invoice</field>
        <field name="arch" type="xml">
            <form string="Customer Invoice" create="false" edit="false" delete="false">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="status_indicator" readonly="1"/>
                        </h1>
                        <h2>
                            <field name="customer" readonly="1"/>
                        </h2>
                    </div>
                    <group>
                        <group string="Invoice Information">
                            <field name="invoice_id" readonly="1"/>
                            <field name="customer_id" readonly="1"/>
                            <field name="invoice_date" readonly="1"/>
                            <field name="invoice_date_due" readonly="1"/>
                            <field name="revenue" readonly="1"/>
                        </group>
                        <group string="Status Information">
                            <field name="invoice_state" readonly="1"/>
                            <field name="payment_state" readonly="1"/>
                            <field name="invoice_status" readonly="1"/>
                            <field name="overdue_category" readonly="1"/>
                            <field name="days_overdue" readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <group string="Issue Flags">
                            <field name="is_invoicing_issue" readonly="1"/>
                            <field name="is_bad_debt_issue" readonly="1"/>
                        </group>
                        <group string="Metadata">
                            <field name="created_date" readonly="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_mart_customer_invoice_search" model="ir.ui.view">
        <field name="name">mart.customer.invoice.search</field>
        <field name="model">mart.customer.invoice</field>
        <field name="arch" type="xml">
            <search string="Customer Invoice">
                <field name="customer" string="Customer" filter_domain="[('customer', 'ilike', self)]"/>
                <field name="invoice_status"/>
                <field name="overdue_category"/>

                <separator/>
                <filter name="overdue" string="Overdue" domain="[('invoice_status', '=', 'OVERDUE')]"/>
                <filter name="due_today" string="Due Today" domain="[('invoice_status', '=', 'DUE TODAY')]"/>
                <filter name="paid" string="Paid" domain="[('invoice_status', '=', 'Paid')]"/>
                <filter name="invoicing_issues" string="Invoicing Issues" domain="[('is_invoicing_issue', '=', True)]"/>
                <filter name="bad_debt_issues" string="Bad Debt Issues" domain="[('is_bad_debt_issue', '=', True)]"/>

                <separator/>
                <filter name="current_month" string="Current Month"
                        domain="[('invoice_date', '>=', (context_today()).strftime('%Y-%m-01')),
                                ('invoice_date', '&lt;', (context_today() + relativedelta(months=1)).strftime('%Y-%m-01'))]"/>

                <group expand="1" string="Group By">
                    <filter name="group_by_customer" string="Customer" context="{'group_by': 'customer'}"/>
                    <filter name="group_by_invoice_status" string="Invoice Status" context="{'group_by': 'invoice_status'}"/>
                    <filter name="group_by_overdue_category" string="Overdue Category" context="{'group_by': 'overdue_category'}"/>
                    <filter name="group_by_invoice_date" string="Invoice Date" context="{'group_by': 'invoice_date:month'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_mart_customer_invoice" model="ir.actions.act_window">
        <field name="name">Customer Invoice</field>
        <field name="res_model">mart.customer.invoice</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Customer Invoice
            </p>
            <p>
                This data contains aggregated customer invoice information for analysis.
                Data is refreshed daily automatically.
            </p>
        </field>
    </record>

    <!-- Menu -->
    <menuitem id="menu_mart_customer_invoice"
              name="Customer Invoice"
              parent="menu_mart_status_vehicle_root"
              action="action_mart_customer_invoice"
              sequence="10"/>

</odoo>